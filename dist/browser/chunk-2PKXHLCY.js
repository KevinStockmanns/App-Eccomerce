import{a as q}from"./chunk-WYGNNODF.js";import{b as N}from"./chunk-YPRR3QM6.js";import{a as j,b as A,m as R,o as D,s as z}from"./chunk-E42GPLRZ.js";import{a as H}from"./chunk-DGK2EHOG.js";import{a as L}from"./chunk-RR3A66G7.js";import{o as F,q as T,r as E,v as $,x as V}from"./chunk-BC2EWL22.js";import{$a as I,Bb as U,Ea as y,Ja as d,Ka as x,Xa as _,Z as S,Za as b,bb as m,db as M,eb as O,fb as c,ga as u,gb as l,ha as C,hb as g,ib as h,mb as f,nb as r,vb as s,xb as k,yb as w}from"./chunk-LPK2HR6M.js";var Y=(e,o)=>o.id;function J(e,o){e&1&&(c(0,"h1",7),s(1,"Subir Im\xE1genes"),l(),c(2,"p")(3,"b"),s(4,"\xA1Ya casi esta todo listo!"),l(),s(5," Solo falta agregar las im\xE1genes de las versiones"),l())}function G(e,o){e&1&&(c(0,"p"),s(1,"Debes subir la(s) im\xE1gen(es) de la(s) version(es) que no tengan una im\xE1gen, son las que aparecen en color gris."),l())}function K(e,o){if(e&1&&(c(0,"h1",7),s(1,"Actualizar Producto"),l(),c(2,"p"),s(3,"Aqu\xED podras actualizar las im\xE1genes de las versiones"),l(),_(4,G,2,0,"p")),e&2){let t=r();d(4),m(4,t.oneToUpload()?4:-1)}}function Q(e,o){if(e&1&&g(0,"fa-icon",9),e&2){let t=r(3);b("icon",t.iconCheck)}}function W(e,o){if(e&1&&g(0,"fa-icon",9),e&2){let t=r(3);b("icon",t.iconNotCheck)}}function X(e,o){if(e&1&&g(0,"span"),e&2){let t=r().$implicit,i=r(2);I("checked",i.imagenCharged[t.id])}}function Z(e,o){if(e&1&&(c(0,"div",8),_(1,Q,1,1,"fa-icon")(2,W,1,1),l(),_(3,X,1,2,"span")),e&2){let t=o.$implicit,i=o.$index,n=o.$index,a=o.$count,p=r(2);I("checked",p.imagenCharged[t.id])("right",i!=p.producto.versiones.length-1)("left",i!=0),d(),m(1,p.imagenCharged[t.id]?1:2),d(2),m(3,n!==a-1?3:-1)}}function ee(e,o){if(e&1&&(c(0,"div",4),M(1,Z,4,8,null,null,Y),l()),e&2){let t=r();d(),O(t.producto.versiones)}}function te(e,o){if(e&1&&g(0,"img",15),e&2){let t=r().$implicit,i=r();b("src",i.selectedImages[t.id]||i.imgUrl+"/"+t.imagen,y)("alt","imagen de "+t.nombre)}}function ne(e,o){e&1&&s(0," Subir y Publicar ")}function ie(e,o){e&1&&s(0," Cambiar y Publicar ")}function oe(e,o){if(e&1){let t=h();c(0,"button",16),f("click",function(){u(t);let n=r(2).$implicit,a=r();return C(a.onSubmit(n.id,!0))}),_(1,ne,1,0)(2,ie,1,0),l()}if(e&2){let t=r(3);d(),m(1,t.fromCrear?1:2)}}function ae(e,o){e&1&&s(0," Subir y Ocultar ")}function re(e,o){e&1&&s(0," Cambiar y Ocultar ")}function le(e,o){if(e&1){let t=h();c(0,"button",16),f("click",function(){u(t);let n=r(2).$implicit,a=r();return C(a.onSubmit(n.id,!1))}),_(1,ae,1,0)(2,re,1,0),l()}if(e&2){let t=r(3);d(),m(1,t.fromCrear?1:2)}}function ce(e,o){e&1&&s(0," Subir Im\xE1gen ")}function de(e,o){e&1&&s(0," Cambiar Im\xE1gen ")}function se(e,o){if(e&1){let t=h();_(0,oe,3,1,"button",14)(1,le,3,1,"button",14),c(2,"button",16),f("click",function(){u(t);let n=r().$implicit,a=r();return C(a.onSubmit(n.id,n.estado))}),_(3,ce,1,0)(4,de,1,0),l()}if(e&2){let t=r().$implicit,i=r();m(0,t.estado?-1:0),d(),m(1,t.estado?1:-1),d(2),m(3,i.fromCrear?3:4)}}function me(e,o){e&1&&g(0,"app-loader")}function pe(e,o){if(e&1){let t=h();c(0,"div",5)(1,"div",10),f("click",function(){let n=u(t).$implicit,a=r();return C(a.openVersion(n.id))}),c(2,"span"),s(3),l(),g(4,"fa-icon",9),l(),c(5,"div",11),_(6,te,1,2,"img"),c(7,"div",12)(8,"input",13),f("change",function(n){let a=u(t).$implicit,p=r();return C(p.onFileSelected(n,a))}),l(),_(9,se,5,3,"button",14)(10,me,1,0,"app-loader"),l()()()}if(e&2){let t=o.$implicit,i=o.$index,n=r();I("uploaded",n.imagenCharged[t.id])("open",n.fromCrear?t.id&&!n.imagenCharged[t.id]:n.versionOpen==t.id),d(3),w("",i+1," ",t.nombre,""),d(),b("icon",n.iconChevron),d(2),m(6,t.imagen||n.selectedImages[t.id]?6:-1),d(3),m(9,!n.loading&&n.selectedImages[t.id]?9:-1),d(),m(10,n.loading&&n.versionOpen==t.id?10:-1)}}function _e(e,o){if(e&1){let t=h();c(0,"button",17),f("click",function(){u(t);let n=r();return C(n.onFinish())}),s(1,"Mantener Privado"),l(),c(2,"button",18),f("click",function(){u(t);let n=r();return C(n.onActivar())}),s(3,"Publicar"),l()}}function ge(e,o){e&1&&g(0,"app-loader")}var Se=(()=>{let o=class o{constructor(i,n,a,p){this.productoService=i,this.activatedRoute=n,this.router=a,this.noti=p,this.fromCrear=!0,this.iconChevron=R,this.iconCheck=z,this.iconNotCheck=D,this.imgUrl=V,this.selectedImages={},this.realImages={},this.imagenCharged={},this.versionOpen=0,this.loading=!1,this.loadingResponse=!1,this.producto=i.productoSelected,this.fromCrear=n.snapshot.queryParamMap.get("a")=="c",this.imagenCharged=JSON.parse(localStorage.getItem("imagenCharged")||"{}")}onFileSelected(i,n){let a=i.target;if(a.files&&a.files[0]){let p=a.files[0],v=["image/jpeg","image/png","image/webp"];if(a.files.length!==1){this.noti.notificate("Solo se puede subir un archivo a la vez",{error:!0});return}if(!v.includes(p.type)){this.noti.notificate("El formato del archivo no es v\xE1lido. Acepta jpeg, png o webp",{error:!0});return}this.realImages[n.id]=p;let P=new FileReader;P.onload=B=>{this.selectedImages[n.id]=B.target.result},P.readAsDataURL(p)}}onSubmit(i,n){let a=this.realImages[i];if(console.log(a),console.log(i),a){this.loading=!0;let p=new FormData;p.append("imagen",a),this.productoService.uploadImage(p,i,n).subscribe({next:v=>{this.imagenCharged[i]=!0,localStorage.setItem("imagenCharged",JSON.stringify(this.imagenCharged)),this.loading=!1},error:v=>{v.error?.errors?(v.error.errors.forEach(P=>this.noti.notificate(P.error,{error:!0})),this.loading=!1):(this.noti.notificate("Ocurrio un error al subir la imagen",{err:!0}),this.loading=!1)}})}}openVersion(i){this.versionOpen==i?this.versionOpen=0:this.versionOpen=i}onFinish(){localStorage.removeItem("imagenCharged")}onActivar(){this.loadingResponse=!0,this.productoService.activateProduct(this.producto.id,{all:!1}).subscribe({next:i=>{this.loadingResponse=!1,this.router.navigate(["/productos"])},error:i=>{this.loadingResponse=!1,i.error?.errors?i.error.errors.forEach(n=>{this.noti.notificate(n.error,{error:!0})}):this.noti.notificate("Ocurrio un error al activar el producto",{error:!0})}})}oneToUpload(){return this.producto.versiones.some(i=>i.imagen==null)}};o.\u0275fac=function(n){return new(n||o)(x(N),x(F),x(T),x(L))},o.\u0275cmp=S({type:o,selectors:[["app-upload-image-page"]],standalone:!0,features:[U],decls:15,vars:5,consts:[[1,"main","content"],[1,"upload-image"],[1,"upload-header"],[1,"upload-body"],[1,"uploader-indicator"],[1,"version"],[1,"upload-footer"],[1,"title"],[1,"item"],[3,"icon"],[1,"version-header","cursor",3,"click"],[1,"version-body"],[1,"actions"],["type","file",3,"change"],[1,"btn","btn-primary","cursor"],[3,"src","alt"],[1,"btn","btn-primary","cursor",3,"click"],["routerLink","/productos",1,"btn","btn-simple","red",3,"click"],[1,"btn","btn-simple",3,"click"]],template:function(n,a){n&1&&(g(0,"back-btn"),c(1,"main",0)(2,"section",1)(3,"article",2),_(4,J,6,0)(5,K,5,1),l(),c(6,"article",3),_(7,ee,3,0,"div",4),c(8,"h2"),s(9),l(),M(10,pe,11,10,"div",5,Y),l(),c(12,"article",6),_(13,_e,4,0)(14,ge,1,0,"app-loader"),l()()()),n&2&&(d(4),m(4,a.fromCrear?4:5),d(3),m(7,a.producto.versiones.length>1?7:-1),d(2),k("Versiones de '",a.producto.nombre,"'"),d(),O(a.producto.versiones),d(3),m(13,a.fromCrear&&!a.loadingResponse?13:-1),d(),m(14,a.loadingResponse?14:-1))},dependencies:[q,A,j,H,$,E],styles:['.main[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:calc(100vh - var(--headerHeight) - 2rem)}h2[_ngcontent-%COMP%]{font-size:1.1rem}.upload-image[_ngcontent-%COMP%]{display:grid;gap:.5rem;padding:1rem;width:100%;max-width:500px;border-radius:var(--borderrHigh);background-color:var(--bgCardColor)}.upload-header[_ngcontent-%COMP%]{display:grid;gap:.5rem}.title[_ngcontent-%COMP%]{justify-self:center}.upload-body[_ngcontent-%COMP%]{display:grid;gap:.5rem}.uploader-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.uploader-indicator[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:relative;display:grid;place-items:center;width:1.5rem;height:1.5rem;border-radius:50%;background-color:var(--bgSecondColor);transition:var(--transitionFast)}.uploader-indicator[_ngcontent-%COMP%] > div.checked[_ngcontent-%COMP%]{background-color:var(--mainMidAlphaColor)}.uploader-indicator[_ngcontent-%COMP%] > div.right[_ngcontent-%COMP%]:after, .uploader-indicator[_ngcontent-%COMP%] > div.left[_ngcontent-%COMP%]:before{content:"";position:absolute;top:50%;right:100%;transform:translateY(-50%);width:0;height:3px;transition:var(--transitionFast) var(--transitionMid);background-image:linear-gradient(90deg,transparent,var(--mainMidAlphaColor));z-index:10}.uploader-indicator[_ngcontent-%COMP%] > div.right[_ngcontent-%COMP%]:after{left:100%;background-image:linear-gradient(90deg,var(--mainMidAlphaColor),transparent)}.uploader-indicator[_ngcontent-%COMP%] > div.left.checked[_ngcontent-%COMP%]:before, .uploader-indicator[_ngcontent-%COMP%] > div.right.checked[_ngcontent-%COMP%]:after{width:1.5rem}.uploader-indicator[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{position:relative;width:1.5rem;height:3px;background-color:var(--bgSecondColor)}.version[_ngcontent-%COMP%]{border-radius:var(--borderrHigh);background-color:var(--bgSecondColor);height:var(--headerHeight);overflow:hidden;transition:var(--transitionFast)}.version.open[_ngcontent-%COMP%]{height:calc(var(--headerHeight) + 300px)}.version.uploaded[_ngcontent-%COMP%]{background-color:var(--mainMidAlphaColor)}.version-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;-webkit-user-select:none;user-select:none;padding:1rem}.version-body[_ngcontent-%COMP%]{display:grid;gap:.5rem;transform:scaleY(0);height:0;transition:var(--transitionFast);overflow:auto}.version.open[_ngcontent-%COMP%]   .version-body[_ngcontent-%COMP%]{padding:1rem;height:300px;transform:scaleY(1)}.version-body[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{justify-self:center;width:100%;max-width:400px;height:250px;object-fit:cover;object-position:center;border-radius:var(--borderrLow)}.actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;justify-items:center}.upload-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center}.upload-footer[_ngcontent-%COMP%]:has(.loader){justify-content:center}']});let e=o;return e})();export{Se as UploadImagePageComponent};
