import{a as Y}from"./chunk-WYGNNODF.js";import{a as W,b as X}from"./chunk-YPRR3QM6.js";import{a as q,b as u,c as R,d as D,e as $,f as j,g as z,h as B,i as G,m as H,n as U,o as Z}from"./chunk-ZVN7DDCF.js";import{a as I,b as F,h as L,n as N}from"./chunk-E42GPLRZ.js";import{b as Q}from"./chunk-AC3WT4O5.js";import{a as K}from"./chunk-DGK2EHOG.js";import{a as J}from"./chunk-RR3A66G7.js";import{o as k,q as T}from"./chunk-BC2EWL22.js";import{$a as p,Bb as w,Ja as o,Ka as b,Xa as f,Z as y,Za as P,ab as O,bb as d,db as M,eb as A,fb as a,ga as C,gb as s,ha as x,hb as h,ib as E,mb as g,nb as m,vb as c,wb as V,xb as v}from"./chunk-LPK2HR6M.js";function te(r,l){return this.idUnique()}function ie(r,l){r&1&&(a(0,"p",8),c(1,"El nombre es requerido."),s())}function re(r,l){if(r&1&&(a(0,"p",8),c(1),s()),r&2){let n=m();o(),v("El nombre debe tener al menos ",n.getError("nombre","minlength").requiredLength," caracteres.")}}function ne(r,l){if(r&1&&(a(0,"p",8),c(1),s()),r&2){let n=m();o(),v("El nombre puede tener hasta ",n.getError("nombre","maxlength").requiredLength," caracteres.")}}function oe(r,l){r&1&&(a(0,"p",8),c(1,"El nombre acepta letras, n\xFAmeros y espacios en blanco."),s())}function ae(r,l){if(r&1){let n=E();a(0,"div",18),g("click",function(){C(n);let t=m();return x(t.addVersion())}),h(1,"fa-icon",19),a(2,"span"),c(3,"AGREGAR"),s()()}if(r&2){let n=m();o(),P("icon",n.iconPlus)}}function se(r,l){if(r&1){let n=E();a(0,"div",20),g("click",function(){C(n);let t=m();return x(t.activateDeleteMood())}),h(1,"fa-icon",19),a(2,"span"),c(3),s()()}if(r&2){let n=m();o(),P("icon",n.iconTrash),o(2),V(n.deleteMood?"LISTO":"ELIMINAR")}}function ce(r,l){r&1&&(a(0,"p",8),c(1,"El nombre es requerido."),s())}function le(r,l){if(r&1&&(a(0,"p",8),c(1),s()),r&2){let n=m().$index,e=m();o(),v("El nombre debe tener al menos ",e.getError("nombre","minlength",n).requiredLength," caracteres.")}}function de(r,l){if(r&1&&(a(0,"p",8),c(1),s()),r&2){let n=m().$index,e=m();o(),v("El nombre puede tener hasta ",e.getError("nombre","maxlength",n).requiredLength," caracteres.")}}function me(r,l){r&1&&(a(0,"p",8),c(1,"El nombre acepta letras, n\xFAmeros y espacios en blanco."),s())}function ue(r,l){r&1&&(a(0,"p",8),c(1,"El nombre no debe repetirse."),s())}function pe(r,l){if(r&1&&(a(0,"p",8),c(1),s()),r&2){let n=m().$index,e=m();o(),v("La descripci\xF3n debe tener al menos ",e.getError("descripcion","minlength",n).requiredLength," caracteres.")}}function he(r,l){if(r&1&&(a(0,"p",8),c(1),s()),r&2){let n=m().$index,e=m();o(),v("La descripci\xF3n puede tener hasta ",e.getError("descripcion","maxlength",n).requiredLength," caracteres.")}}function fe(r,l){r&1&&(a(0,"p",8),c(1,"La descripci\xF3n acepta letras, n\xFAmeros y espacios en blanco."),s())}function ge(r,l){r&1&&(a(0,"p",8),c(1,"El precio es requerido."),s())}function ve(r,l){r&1&&(a(0,"p",8),c(1,"El precio debe ser positivo."),s())}function _e(r,l){r&1&&(a(0,"p",8),c(1,"El precio debe ser positivo."),s())}function Ce(r,l){r&1&&(a(0,"p",8),c(1,"El stock debe ser positivo."),s())}function xe(r,l){if(r&1){let n=E();a(0,"div",21)(1,"div",22)(2,"div",23),g("click",function(){let t=C(n).$index,i=m();return x(i.delete(t))}),h(3,"fa-icon",19),a(4,"span"),c(5,"Eliminar Versi\xF3n"),s()()(),a(6,"div",5)(7,"div",6),h(8,"input",7),a(9,"label"),c(10,"Nombre"),s()(),f(11,ce,2,0,"p",8)(12,le,2,1,"p",8)(13,de,2,1,"p",8)(14,me,2,0,"p",8)(15,ue,2,0,"p",8),s(),a(16,"div",24),g("click",function(){let t=C(n).$index,i=m();return x(i.toggleBtn("estado",t))}),a(17,"div",25)(18,"label"),c(19,"Estado"),s(),h(20,"div",10),s()(),a(21,"div",5)(22,"div",6),h(23,"textarea",26),a(24,"label"),c(25,"Descripci\xF3n"),s()(),f(26,pe,2,1,"p",8)(27,he,2,1,"p",8)(28,fe,2,0,"p",8),s(),a(29,"div",5)(30,"div",6),h(31,"input",27),a(32,"label"),c(33,"Precio"),s()(),f(34,ge,2,0,"p",8)(35,ve,2,0,"p",8),s(),a(36,"div",5)(37,"div",6),h(38,"input",28),a(39,"label"),c(40,"Precio Descuento"),s()(),f(41,_e,2,0,"p",8),s(),a(42,"div",5)(43,"div",6),h(44,"input",29),a(45,"label"),c(46,"Stock"),s()(),f(47,Ce,2,0,"p",8),s()()}if(r&2){let n=l.$index,e=m();p("eliminar",e.updatePage&&e.hasValue("accion",n)=="ELIMINAR"),P("formArrayName",n),o(),p("active",e.deleteMood),o(2),P("icon",e.iconTrash),o(3),p("error",e.hasOneError("nombre",n))("withValue",e.hasValue("nombre",n)),o(5),d(11,e.hasError("nombre","required",n)?11:-1),o(),d(12,e.hasError("nombre","minlength",n)?12:-1),o(),d(13,e.hasError("nombre","maxlength",n)?13:-1),o(),d(14,e.hasError("nombre","pattern",n)?14:-1),o(),d(15,e.hasError("nombre","duplicateVersion",n)?15:-1),o(2),p("active",e.hasValue("estado",n)),o(3),p("active",e.hasValue("estado",n)),o(),p("error",e.hasOneError("descripcion",n))("withValue",e.hasValue("descripcion",n)),o(5),d(26,e.hasError("descripcion","minlength",n)?26:-1),o(),d(27,e.hasError("descripcion","maxlength",n)?27:-1),o(),d(28,e.hasError("descripcion","pattern",n)?28:-1),o(),p("error",e.hasOneError("precio",n))("withValue",e.hasValue("precio",n)),o(5),d(34,e.hasError("precio","required",n)?34:-1),o(),d(35,e.hasError("precio","min",n)?35:-1),o(),p("error",e.hasOneError("precioDescuento",n))("withValue",e.hasValue("precioDescuento",n)),o(5),d(41,e.hasError("precioDescuento","min",n)?41:-1),o(),p("error",e.hasOneError("stock",n))("withValue",e.hasValue("stock",n)),o(5),d(47,e.hasError("stock","min",n)?47:-1)}}function be(r,l){r&1&&h(0,"app-loader")}function Pe(r,l){if(r&1){let n=E();a(0,"button",32),g("click",function(){C(n);let t=m(2);return x(t.redirectToImages("u"))}),c(1,"CAMBIAR IM\xC1GEN"),s()}}function Ee(r,l){if(r&1){let n=E();f(0,Pe,2,0,"button",30),a(1,"button",31),g("click",function(){C(n);let t=m();return x(t.onSubmit())}),c(2),s()}if(r&2){let n=m();d(0,n.updatePage?0:-1),o(2),V(n.updatePage?"ACTUALIZAR":"CREAR")}}var qe=(()=>{let l=class l{constructor(e,t,i,_,S,ee){this.formBuilder=e,this.activatedRoute=t,this.productoService=i,this.notiService=_,this.utils=S,this.router=ee,this.updatePage=!1,this.iconPlus=N,this.iconTrash=L,this.totalVersiones=0,this.deleteMood=!1,this.loading=!1,this.idIncrementer=0,this.initValue=null,this.subscriptionVersiones=null,this.producto=null,this.updatePage=t.snapshot.paramMap.get("action")=="update",this.form=e.group({nombre:[i.productoSelected?.nombre||"",[u.required,u.pattern("[a-zA-Z\xF1\xD1\xE1\xE9\xED\xF3\xFA\xC1\xC9\xCD\xD3\xDA0-9\\s]+"),u.minLength(4),u.maxLength(50)]],versiones:e.array([],u.required)}),this.updatePage?(this.producto=i.productoSelected,this.addVersion(this.productoService.productoSelected?.versiones),this.form.addControl("estado",this.formBuilder.control(this.productoService.productoSelected?.estado)),this.initValue=this.form.value):this.addVersion()}ngAfterViewInit(){this.subscribeToVersionesChanges()}ngOnDestroy(){this.subscriptionVersiones&&this.subscriptionVersiones.unsubscribe()}subscribeToVersionesChanges(){let e=this.form.get("versiones");this.subscriptionVersiones=e.valueChanges.subscribe(()=>{this.totalVersiones=e.value.length})}activateDeleteMood(){this.totalVersiones>0?this.deleteMood=!this.deleteMood:this.deleteMood&&(this.deleteMood=!1)}delete(e){let t=this.form.get("versiones");if(t)if(this.updatePage){let i=t.at(e);i.value.hasOwnProperty("accion")?i.value.idVersion&&i.value.idVersion!=0?i.removeControl("accion"):t.removeAt(e):i.addControl("accion",this.formBuilder.control("ELIMINAR"))}else t.removeAt(e),this.totalVersiones<=1&&(this.deleteMood=!1)}addVersion(e){e||(e=[{nombre:"",descripcion:"",precio:0,precioDescuento:0,stock:0,estado:!1,fecha:"",id:0,imagen:null}]),e?.forEach(t=>{this.form.get("versiones").push(this.formBuilder.group({idVersion:[t.id==0?null:t.id],nombre:[t.nombre||"",[u.required,u.pattern("[a-zA-Z\xF1\xD1\xE1\xE9\xED\xF3\xFA\xC1\xC9\xCD\xD3\xDA0-9\\s]+"),u.minLength(4),u.maxLength(50),this.uniqueVersion()]],descripcion:[t.descripcion||"",[u.pattern("[a-zA-Z\xF1\xD1\xE1\xE9\xED\xF3\xFA\xC1\xC9\xCD\xD3\xDA0-9\\s\\-\\_\\.\\(\\)\\\xBF\\?\\\xA1\\!]+"),u.minLength(15),u.maxLength(2e3)]],precio:[t.precio||1e4,[u.required,u.min(1)]],precioDescuento:[t.precioDescuento||null,u.min(0)],stock:[t.stock||1,u.min(1)],estado:[t.estado||!1]})),t.id==0&&this.form.get("versiones").at(this.form.get("versiones").length-1).addControl("accion",this.formBuilder.control("AGREGAR"))})}uniqueVersion(){return e=>!e||!e.parent||!(e.parent.parent instanceof H)?null:e.parent.parent.controls.map(S=>S.get("nombre").value.trim().toLowerCase()).filter(S=>S===e.value.trim().toLowerCase()).length>1?{duplicateVersion:!0}:null}onSubmit(){this.form.markAllAsTouched(),this.deleteMood=!1;let e=this.form.value;this.form.valid&&(this.loading=!0,this.updatePage?JSON.stringify(this.initValue)!=JSON.stringify(e)?(console.log("Hubo cambio"),e=this.utils.getChanges(this.initValue,e,["idVersion"],"idVersion"),e=this.utils.deleteObjectEmpty(e),e.versiones&&(e.versiones=this.removeIfOnlyHas(e.versiones,"idVersion")),e.versiones.forEach(t=>{t.hasOwnProperty("accion")||(t.accion="ACTUALIZAR")}),console.log(this.productoService.productoSelected),console.log(e),this.productoService.updateProducto(this.productoService.productoSelected?.id,e).subscribe({next:t=>{this.loading=!1,Q(t.body,"producto"),this.hasOneCreation(e.versiones||[])?(this.productoService.setProductoSelected(t.body),this.redirectToImages("u")):(this.notiService.notificate("Producto actualizado con \xE9xito.",{time:3e3}),this.router.navigate(["/productos"]))},error:t=>{this.loading=!1,t.error?.errors?t.error.errors.forEach(i=>{this.notiService.notificate(i.error,{error:!0})}):this.notiService.notificate("Ocurrio un error al actualizar el producto.",{error:!0})}})):(this.notiService.notificate("No se detectaron cambios para actualizar.",{error:!0,time:3e3}),this.loading=!1):(e=this.utils.deleteObjectEmpty(e),this.productoService.createProducto(e).subscribe({next:t=>{console.log(t),this.productoService.setProductoSelected(t.body),this.router.navigate(["/productos/versiones/images"],{queryParams:{a:"c"}}),this.loading=!1},error:t=>{console.log(t),t.error.errors?t.error.errors.forEach(i=>{this.notiService.notificate(i.error,{error:!0})}):this.notiService.notificate("Ocurrio un error al crear el producto",{error:!0}),this.loading=!1}})))}removeIfOnlyHas(e,t){return e.filter(i=>!(Object.keys(i).length===1&&i.hasOwnProperty(t)))}idUnique(){return this.idIncrementer++,this.idIncrementer}toggleBtn(e,t){if(t==null)this.form.get(e)?.setValue(!this.form.get(e)?.value);else{let i=this.form.get("versiones");i.at(t).get(e)?.setValue(!i.at(t).get(e)?.value)}}getVersionesForm(){return this.form.get("versiones").controls}hasValue(e,t){if(t==null)return this.form.get(e)?.value;let i=this.form.get("versiones").at(t).get(e)?.value;return i||i===0}hasVersionValue(e,t){return this.form.get("versiones").at(e).get(t)?.value}hasError(e,t,i){if(i==null)return this.form.get(e)?.hasError(t)&&this.form.get(e)?.touched;let _=this.form.get("versiones").at(i).get(e);return _?.hasError(t)&&_.touched}hasOneError(e,t){if(t==null)return this.form.get(e)?.invalid&&this.form.get(e)?.touched;let i=this.form.get("versiones").at(t).get(e);return i?.invalid&&i.touched}getError(e,t,i){return i==null?(this.form.get(e)?.errors)[t]:(this.form.get("versiones").at(i).get(e)?.errors)[t]}get productoId(){return this.productoService.productoSelected?.id}redirectToImages(e){this.router.navigate(["/productos/versiones/images"],{queryParams:{a:e}})}hasOneCreation(e){for(let t=0;t<e.length;t++){let i=e[t];if(i.hasOwnProperty("accion")&&i.accion=="AGREGAR")return!0}return!1}};l.\u0275fac=function(t){return new(t||l)(b(U),b(k),b(X),b(J),b(W),b(T))},l.\u0275cmp=y({type:l,selectors:[["app-create-product-page"]],standalone:!0,features:[w],decls:33,vars:22,consts:[[1,"main","content"],[1,"create"],[1,"title"],[1,"create-body"],[1,"form",3,"formGroup"],[1,"form-div"],[1,"form-div-input"],["type","text","formControlName","nombre"],[1,"form-div-error"],[1,"form-div-toggle","cursor",3,"click"],[1,"toggle"],["formArrayName","versiones",1,"form-divs","versiones"],[1,"versiones-actions"],[1,"add-version","btn","btn-simple","cursor"],[1,"delete-version","btn","btn-simple","red","cursor"],[1,"versiones-container"],[1,"version"],[1,"create-footer"],[1,"add-version","btn","btn-simple","cursor",3,"click"],[3,"icon"],[1,"delete-version","btn","btn-simple","red","cursor",3,"click"],[1,"version",3,"formArrayName"],[1,"delete-mood"],[1,"cursor",3,"click"],[1,"form-div","cursor",3,"click"],[1,"form-div-toggle"],["formControlName","descripcion"],["type","number","formControlName","precio"],["type","number","formControlName","precioDescuento"],["type","number","formControlName","stock"],[1,"btn","btn-simple","cursor"],[1,"btn","btn-primary","cursor",3,"click"],[1,"btn","btn-simple","cursor",3,"click"]],template:function(t,i){t&1&&(h(0,"back-btn"),a(1,"main",0)(2,"section",1)(3,"h1",2),c(4),s(),a(5,"div",3)(6,"form",4)(7,"div",5)(8,"div",6),h(9,"input",7),a(10,"label"),c(11,"Nombre"),s()(),f(12,ie,2,0,"p",8)(13,re,2,1,"p",8)(14,ne,2,1,"p",8)(15,oe,2,0,"p",8),s(),a(16,"div",5)(17,"div",9),g("click",function(){return i.toggleBtn("estado")}),a(18,"label"),c(19,"Estado"),s(),h(20,"div",10),s()(),a(21,"div",11)(22,"p"),c(23),s(),a(24,"div",12),f(25,ae,4,1,"div",13)(26,se,4,2,"div",14),s(),a(27,"div",15),M(28,xe,48,42,"div",16,te,!0),s()()()(),a(30,"div",17),f(31,be,1,0,"app-loader")(32,Ee,3,2),s()()()),t&2&&(o(2),O("view-transition-name: producto"+i.productoId+";"),o(2),V(i.updatePage?"Actualizar Producto":"Crear Producto"),o(2),P("formGroup",i.form),o(),p("withValue",i.hasValue("nombre"))("error",i.hasOneError("nombre")),o(5),d(12,i.hasError("nombre","required")?12:-1),o(),d(13,i.hasError("nombre","minlength")?13:-1),o(),d(14,i.hasError("nombre","maxlength")?14:-1),o(),d(15,i.hasError("nombre","pattern")?15:-1),o(2),p("active",i.hasValue("estado")),o(3),p("active",i.hasValue("estado")),o(),p("delete",i.deleteMood),o(2),v("Versiones ",i.totalVersiones>0?"("+i.totalVersiones+")":"",""),o(2),d(25,i.totalVersiones<6?25:-1),o(),d(26,i.totalVersiones>0||i.deleteMood?26:-1),o(2),A(i.getVersionesForm()),o(3),d(31,i.loading?31:32))},dependencies:[Z,$,q,j,R,D,z,G,B,Y,F,I,K],styles:['.main[_ngcontent-%COMP%]{width:100%;height:calc(100vh - var(--headerHeight) - 2rem)}.create[_ngcontent-%COMP%]{padding:1rem;display:grid;gap:1rem;align-content:start;margin:0 auto;height:100%;width:100%;max-width:500px;border-radius:var(--borderrHigh);background-color:var(--bgCardColor);overflow-y:auto}.title[_ngcontent-%COMP%]{justify-self:center}.versiones[_ngcontent-%COMP%]{padding:1rem .5rem;border-radius:var(--borderrHigh);background-color:var(--bgSecondColor);overflow:auto;transition:var(--transitionFast)}.versiones.delete[_ngcontent-%COMP%]{background-color:var(--errorAlphaLowColor)}.versiones-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;font-size:.8rem}.delete-version[_ngcontent-%COMP%]{opacity:1;transition:var(--transitionFast)}.versiones[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{font-weight:700}.versiones-container[_ngcontent-%COMP%]{padding:.5rem 0;display:flex;gap:.5rem;overflow:auto}.version[_ngcontent-%COMP%]{position:relative;flex-shrink:0;display:grid;gap:.8rem;padding:.5rem;width:100%;max-width:350px;font-size:.9rem;border-radius:var(--borderrHigh);background-color:var(--bgColor);overflow:hidden;transition:var(--transitionFast);--bgCardColor: var(--bgColor)}.version.eliminar[_ngcontent-%COMP%]{padding:1.5rem;--mainColor: var(--errorAlphaColor);--mainAlphaColorBack: var(--errorAlphaLowColor) }.version.eliminar[_ngcontent-%COMP%]:after{content:"La versi\\f3n se eliminar\\e1";position:absolute;top:.25rem;left:50%;font-size:.8rem;color:var(--errorColor);transform:translate(-50%)}.versiones.delete[_ngcontent-%COMP%]   .version[_ngcontent-%COMP%]{padding:1.5rem}.delete-mood[_ngcontent-%COMP%]{position:absolute;inset:0;display:grid;justify-content:center;align-content:center;transform:scale(0);transform-origin:center;background-color:var(--greyAlphaColor);transition:var(--transitionMid);z-index:100}.delete-mood[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.5rem;padding:1rem;font-weight:700;border-radius:inherit;color:var(--errorColor);background-color:var(--bgCardAlphaColor);-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px)}.delete-mood[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > fa-icon[_ngcontent-%COMP%]{font-size:3rem}.delete-mood.active[_ngcontent-%COMP%]{border-radius:inherit;transform:scale(1)}.version[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{height:4rem}.create-footer[_ngcontent-%COMP%]{display:grid;justify-content:stretch;align-items:center;gap:.3rem}']});let r=l;return r})();export{qe as CreateProductPageComponent};
