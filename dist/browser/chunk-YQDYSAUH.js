import{b as le}from"./chunk-YPRR3QM6.js";import{a as W,b as C,c as X,d as Y,e as ee,g as te,i as ie,n as ne,o as oe}from"./chunk-ZVN7DDCF.js";import{a as J,b as K,h as Z,q as Q}from"./chunk-E42GPLRZ.js";import{b as de}from"./chunk-AC3WT4O5.js";import{a as H}from"./chunk-MD5CZJF7.js";import{a as ae}from"./chunk-DGK2EHOG.js";import{a as re}from"./chunk-RR3A66G7.js";import{a as $,b as N}from"./chunk-NMAY4UGY.js";import{b as z,c as I,d as k,l as G,o as B}from"./chunk-BC2EWL22.js";import{$a as h,Bb as A,Cb as S,Db as O,Ha as D,Ja as a,Ka as v,Xa as p,Z as M,Za as P,bb as s,db as V,eb as U,fb as r,ga as b,gb as o,ha as E,hb as u,ib as x,mb as _,na as j,nb as f,vb as l,wb as T,xb as w,yb as L}from"./chunk-LPK2HR6M.js";function ue(n,d){n&1&&(r(0,"span",2),l(1,"Se eliminar\xE1 de la orden."),o())}function fe(n,d){if(n&1){let c=x();r(0,"div")(1,"input",9),_("blur",function(i){b(c);let e=f();return E(e.cambiarPrecio(i))}),o(),l(2," ARS "),o()}if(n&2){let c=f();a(),P("value",c.orden==null?null:c.orden.precioUnitario)}}function he(n,d){if(n&1&&(r(0,"span",10),l(1),S(2,"currency"),o()),n&2){let c=f();a(),w("",O(2,1,c.orden==null?null:c.orden.precioUnitario)," ARS")}}var ce=(()=>{let d=class d{constructor(t){this.usuarioService=t,this.cambio=new j,this.iconChevron=Q,this.iconTrash=Z,this.isAdmin=t.isAdmin}modificarCantidad(t){this.orden&&(this.orden.cantidad=this.orden.cantidad+t,this.orden.cantidad<0&&(this.orden.cantidad=0)),this.cambio.emit(this.orden)}cambiarPrecio(t){this.orden&&this.orden.precioUnitario&&(this.orden.precioUnitario=t.target.value)}delete(){this.orden&&(this.orden.cantidad=0,this.cambio.emit(this.orden))}};d.\u0275fac=function(i){return new(i||d)(v(N))},d.\u0275cmp=M({type:d,selectors:[["orden-item"]],inputs:{orden:"orden"},outputs:{cambio:"cambio"},standalone:!0,features:[A],decls:17,vars:11,consts:[[1,"orden-item"],[1,"orden-left"],[1,"orden-empty"],[1,"orden-right"],[1,"icon-left","cursor",3,"click"],[3,"icon"],[1,"cursor",3,"click"],[1,"cursor"],[3,"click","icon"],["type","number",1,"precio-unitario-input",3,"blur","value"],[1,"precio-unitario"]],template:function(i,e){i&1&&(r(0,"section",0)(1,"div",1)(2,"span"),l(3),S(4,"titlecase"),o(),p(5,ue,2,0,"span",2),o(),r(6,"div",3),p(7,fe,3,1,"div")(8,he,3,3),r(9,"span",4),_("click",function(){return e.modificarCantidad(-1)}),u(10,"fa-icon",5),o(),r(11,"span"),l(12),o(),r(13,"span",6),_("click",function(){return e.modificarCantidad(1)}),u(14,"fa-icon",5),o(),r(15,"span",7)(16,"fa-icon",8),_("click",function(){return e.delete()}),o()()()()),i&2&&(h("empty",(e.orden==null?null:e.orden.cantidad)===0),a(3),T(O(4,9,(e.orden==null||e.orden.producto==null?null:e.orden.producto.nombreProducto)+" "+(e.orden==null||e.orden.producto==null?null:e.orden.producto.nombreVersion))),a(2),s(5,(e.orden==null?null:e.orden.cantidad)===0?5:-1),a(2),s(7,e.isAdmin()?7:8),a(3),P("icon",e.iconChevron),a(2),T(e.orden==null?null:e.orden.cantidad),a(2),P("icon",e.iconChevron),a(2),P("icon",e.iconTrash))},dependencies:[I,K,J,k],styles:[".orden-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;transition:var(--transitionUltraFast)}.orden-item.empty[_ngcontent-%COMP%]{padding:.5rem;border-radius:var(--borderrLow);background-color:var(--errorAlphaLowColor)}.orden-left[_ngcontent-%COMP%], .orden-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.orden-empty[_ngcontent-%COMP%]{font-size:.8rem;color:var(--errorColor)}.orden-right[_ngcontent-%COMP%]{gap:1rem;font-size:1.2rem;-webkit-user-select:none;user-select:none}.precio-unitario-input[_ngcontent-%COMP%]{border:none;background-color:transparent;text-align:end;color:inherit;outline:none;width:100px;border:1px solid var(--textAlphaColor);border-radius:var(--borderrMid)}.orden-right[_ngcontent-%COMP%]   .icon-left[_ngcontent-%COMP%]{display:inline-block;transform:rotate(180deg)}.orden-right[_ngcontent-%COMP%]   .cursor[_ngcontent-%COMP%]:hover{color:var(--textColor)}"]});let n=d;return n})();var F=(n,d)=>d.id;function _e(n,d){n&1&&(r(0,"p",10),l(1,"El nombre es requerido."),o())}function Ce(n,d){n&1&&(r(0,"p",10),l(1,"El apellido es requerido."),o())}function ge(n,d){n&1&&(r(0,"p",10),l(1,"El correo es requerido."),o())}function ve(n,d){n&1&&(r(0,"p",10),l(1,"El pa\xEDs es requerido."),o())}function be(n,d){n&1&&(r(0,"p",10),l(1,"La provincia es requerida."),o())}function Ee(n,d){n&1&&(r(0,"p",10),l(1,"La localidad es requerida."),o())}function Pe(n,d){n&1&&(r(0,"p",10),l(1,"El barrio es requerido."),o())}function Se(n,d){n&1&&(r(0,"p",10),l(1,"La direcci\xF3n es requerida."),o())}function Oe(n,d){if(n&1&&(r(0,"div",6)(1,"div",7),u(2,"textarea",31),r(3,"label",32),l(4,"Mensaje (Opcional)"),o()()()),n&2){let c=f();h("error",c.hasOneError("mensaje"))("withValue",c.hasValue("mensaje"))}}function xe(n,d){n&1&&(r(0,"p",10),l(1,"El estado puede ser PENDIENTE, CONFIRMADO, VENDIDO o CANCELADO."),o())}function ye(n,d){if(n&1&&(r(0,"div",6)(1,"div",7),u(2,"input",33),r(3,"label",34),l(4,"Estado"),o()(),p(5,xe,2,0,"p",10),o()),n&2){let c=f();h("error",c.hasOneError("estado"))("withValue",c.hasValue("estado")),a(5),s(5,c.hasError("estado","permitedEstado")?5:-1)}}function Te(n,d){n&1&&(r(0,"span"),l(1,"El pedido no puede estar vac\xEDo"),o())}function Me(n,d){if(n&1){let c=x();r(0,"orden-item",35),_("cambio",function(i){b(c);let e=f();return E(e.onCambioElemento(i))}),o()}if(n&2){let c=d.$implicit;P("orden",c)}}function Ve(n,d){n&1&&u(0,"app-loader")}function Ue(n,d){if(n&1){let c=x();r(0,"button",36),_("click",function(){b(c);let i=f();return E(i.cancelarUpdate())}),l(1,"CANCELAR"),o(),r(2,"button",37),_("click",function(){b(c);let i=f();return E(i.openProducts())}),l(3,"AGREGAR PRODUCTO"),o(),r(4,"button",38),_("click",function(){b(c);let i=f();return E(i.onSubmit())}),l(5,"ACTUALIZAR"),o()}}function we(n,d){if(n&1){let c=x();r(0,"button",37),_("click",function(){b(c);let i=f().$implicit,e=f().$implicit,m=f();return E(m.addProduct(e,i))}),l(1,"AGREGAR"),o()}}function Ae(n,d){n&1&&(r(0,"button",42),l(1,"AGREGADO"),o())}function Ie(n,d){if(n&1&&(r(0,"div",39)(1,"div",40)(2,"span")(3,"b"),l(4),S(5,"titlecase"),o(),l(6),S(7,"titlecase"),S(8,"currency"),o()(),r(9,"div",41),p(10,we,2,0,"button",29)(11,Ae,2,0),o()()),n&2){let c=d.$implicit,t=f().$implicit,i=f();a(4),T(O(5,4,t.nombre)),a(2),L(" ",O(7,6,c.nombre)," (",O(8,8,c.precio)," ARS)"),a(4),s(10,i.isInPedido(c.id)?11:10)}}function ke(n,d){if(n&1&&V(0,Ie,12,10,"div",39,F),n&2){let c=d.$implicit;U(c.versiones)}}function Ne(n,d){n&1&&(r(0,"button",29),l(1,"CARGAR M\xC1S"),o())}function Re(n,d){n&1&&u(0,"app-loader")}var rt=(()=>{let d=class d{constructor(t,i,e,m,y,R,se,q){this.title=t,this.activateRoute=i,this.formBuilder=e,this.cartService=m,this.notification=y,this.productoService=R,this.location=se,this.usuarioService=q,this.elemento=null,this.cantidadTotal=1,this.productos=[],this.currentPage=0,this.totalPage=0,this.loadingResponse=!1,this.openProductsModal=!1,this.isAdmin=q.isAdmin,this.object=this.activateRoute.snapshot.paramMap.get("object"),this.title.setTitle("Actualizar Pedido"),this.elemento=this.cartService.pedidoSelected,this.form=this.formBuilder.group({nombre:[this.elemento?.nombre,[C.required]],apellido:[this.elemento?.apellido,[C.required]],correo:[this.elemento?.correo,[C.required,C.email]],telefono:[this.elemento?.telefono,[C.required]],pais:[this.elemento?.ubicacion.pais,[C.required]],provincia:[this.elemento?.ubicacion.provincia,[C.required]],localidad:[this.elemento?.ubicacion.localidad,[C.required]],barrio:[this.elemento?.ubicacion.barrio,[C.required]],direccion:[this.elemento?.ubicacion.direccion,[C.required]],mensaje:[this.elemento?.mensaje,[]],estado:[this.elemento.estado,[C.required,this.permitedEstado]]}),this.form.valueChanges.subscribe(g=>{this.elemento&&(this.elemento.nombre=g.nombre,this.elemento.apellido=g.apellido,this.elemento.correo=g.correo,this.elemento.telefono=g.telefono,this.elemento.ubicacion.pais=g.pais,this.elemento.ubicacion.provincia=g.provincia,this.elemento.ubicacion.localidad=g.localidad,this.elemento.ubicacion.barrio=g.barrio,this.elemento.ubicacion.direccion=g.direccion,this.elemento.mensaje=g.mensaje,this.elemento.estado=g.estado)})}permitedEstado(t){return t.value!=="PENDIENTE"&&t.value!=="CONFIRMADO"&&t.value!=="CANCELADO"&&t.value!=="VENDIDO"?{permitedEstado:!0}:null}ngOnDestroy(){this.cartService.setPedidoSelected(null)}onSubmit(){this.form.markAllAsTouched();let t=this.form.value;t.ordenes=[],this.hasOneCambio()&&this.cantidadTotal>0&&this.form.valid?(this.loadingResponse=!0,this.elemento?.ordenes.forEach(i=>{let e=this.cartService.pedidoSelected.ordenes.find(m=>m.id===i.id);if(!e&&i.cantidad>0)t.ordenes.push({accion:"AGREGAR",idVersion:i.producto.idVersion,cantidad:i.cantidad});else if(e&&i.cantidad===0)t.ordenes.push({accion:"ELIMINAR",idOrden:i.id});else if(e&&i.cantidad>0&&JSON.stringify(e)!==JSON.stringify(i)){let m={accion:"ACTUALIZAR",cantidad:i.cantidad,idOrden:i.id,precioUnitario:i.precioUnitario};e.precioUnitario===i.precioUnitario&&delete m.precioUnitario,t.ordenes.push(m)}}),JSON.stringify(this.elemento?.ubicacion)!==JSON.stringify(this.cartService.pedidoSelected.ubicacion)&&(t.ubicacion=`${this.elemento?.ubicacion.pais}/-/${this.elemento?.ubicacion.provincia}/-/${this.elemento?.ubicacion.localidad}/-/${this.elemento?.ubicacion.barrio}/-/${this.elemento?.ubicacion.direccion}`),delete t.pais,delete t.provincia,delete t.localidad,delete t.barrio,delete t.direccion,t=this.eliminarElementosVacios(t),t=this.elimminarItemsSinCambio(t,this.cartService.pedidoSelected),console.log(t),this.cartService.actualizarPedido(this.elemento?.id,t).subscribe({next:i=>{this.loadingResponse=!1,de(i.body,"pedido"),this.location.back(),this.notification.notificate("Pedido actualizado con \xE9xito.",{error:!1})},error:i=>{if(this.loadingResponse=!1,i.status>=400){let e=i.error?.errors[0].error||"Ocurrio un error al actualizar el pedido";this.notification.notificate(e,{error:!0,time:5e3})}else this.notification.notificate("Ocurrio un error al actualizar el pedido",{error:!0,time:5e3})}})):this.cantidadTotal==0?this.notification.notificate("No se puede actualizar un pedido sin ordenes.",{error:!0,time:5e3}):this.hasOneCambio()||this.notification.notificate("No se puede actualizar ya que no hay cambios.",{error:!0,time:5e3})}onCambioElemento(t){this.elemento?.ordenes.forEach(i=>{this.elemento&&i.cantidad===0&&this.cartService.pedidoSelected.ordenes.find(e=>e.producto.idVersion==i.producto.idVersion)==null&&(this.elemento.ordenes=this.elemento?.ordenes.filter(e=>e.producto.idVersion!==i.producto.idVersion))}),this.cantidadTotal=this.elemento?.ordenes.reduce((i,e)=>i+e.cantidad,0)||0}hasOneCambio(){return JSON.stringify(this.elemento)!==JSON.stringify(this.cartService.pedidoSelected)}openProducts(){this.productos.length==0?(this.loadingResponse=!0,this.openProductsModal=!0,this.productoService.getProductos({page:this.currentPage}).subscribe({next:t=>{this.productos=t.body.content,this.loadingResponse=!1,this.totalPage=t.body.totalPages},error:t=>{this.notification.notificate("No se pudo obtener los productos. Intentalo m\xE1s tarde.",{error:!0}),this.loadingResponse=!1,this.openProductsModal=!1}})):this.openProductsModal=!0}addProduct(t,i){if(this.elemento?.ordenes.find(m=>m.producto.idVersion==i.id)==null){let m={cantidad:1,id:0,precioUnitario:i.precio,producto:{idProducto:t.id,idVersion:i.id,nombreProducto:t.nombre,nombreVersion:i.nombre},conDescuento:null};this.elemento?.ordenes.push(m),this.cantidadTotal=this.elemento?.ordenes.reduce((y,R)=>y+R.cantidad,0)}}isInPedido(t){return this.elemento?.ordenes.find(i=>i.producto.idVersion==t)!==void 0}cancelarUpdate(){this.location.back()}onKeyEsc(t){t.code==="Escape"&&(this.openProductsModal=!1)}eliminarElementosVacios(t){for(let i in t)(t[i]===null||t[i]===""||t[i].length===0)&&delete t[i];return t}elimminarItemsSinCambio(t,i){for(let e in t)t[e]===i[e]&&delete t[e];return t}hasOneError(t){return this.form?.get(t)?.invalid&&this.form?.get(t)?.touched}hasValue(t){return this.form?.get(t)?.value}hasError(t,i){return this.form?.get(t)?.hasError(i)&&this.form?.get(t)?.touched}};d.\u0275fac=function(i){return new(i||d)(v(G),v(B),v(ne),v($),v(re),v(le),v(z),v(N))},d.\u0275cmp=M({type:d,selectors:[["app-update-page"]],hostBindings:function(i,e){i&1&&_("keydown",function(y){return e.onKeyEsc(y)},!1,D)},standalone:!0,features:[A],decls:78,vars:52,consts:[[1,"main","content"],[1,"update","update-pedido"],[1,"update-header","update-pedido-header"],[1,"title"],[1,"update-body","update-pedido-body"],[3,"formGroup"],[1,"form-div"],[1,"form-div-input"],["type","text","id","nombre","formControlName","nombre"],["for","nombre"],[1,"form-div-error"],["type","text","id","apellido","formControlName","apellido"],["for","apellido"],["type","email","id","correo","formControlName","correo"],["for","correo"],["type","text","id","pais","formControlName","pais"],["for","pais"],["type","text","id","provincia","formControlName","provincia"],["for","provincia"],["type","text","id","localidad","formControlName","localidad"],["for","localidad"],["type","text","id","barrio","formControlName","barrio"],["for","barrio"],["type","text","id","direccion","formControlName","direccion"],["for","direccion"],[1,"pedido-ordenes"],[1,"update-footer","update-pedido-footer"],[1,"products-container"],[1,"products-content"],[1,"btn","btn-simple","cursor"],[1,"btn","btn-simple","cursor",2,"justify-self","center","margin-top","1rem",3,"click"],["id","mensaje","formControlName","mensaje"],["for","mensaje"],["type","text","id","estado","formControlName","estado"],["for","estado"],[3,"cambio","orden"],[1,"btn","btn-simple","neutro","cursor",3,"click"],[1,"btn","btn-simple","cursor",3,"click"],[1,"btn","btn-primary","cursor",3,"click"],[1,"producto"],[1,"producto-left"],[1,"producto-right"],[1,"btn","btn-simple","neutro"]],template:function(i,e){i&1&&(u(0,"app-header"),r(1,"main",0)(2,"section",1)(3,"article",2)(4,"h1",3),l(5),o()(),r(6,"article",4)(7,"h2"),l(8,"Informaci\xF3n de contacto"),o(),r(9,"form",5)(10,"div",6)(11,"div",7),u(12,"input",8),r(13,"label",9),l(14,"Nombre"),o()(),p(15,_e,2,0,"p",10),o(),r(16,"div",6)(17,"div",7),u(18,"input",11),r(19,"label",12),l(20,"Apellido"),o()(),p(21,Ce,2,0,"p",10),o(),r(22,"div",6)(23,"div",7),u(24,"input",13),r(25,"label",14),l(26,"Correo"),o()(),p(27,ge,2,0,"p",10),o(),r(28,"div",6)(29,"div",7),u(30,"input",15),r(31,"label",16),l(32,"Pa\xEDs"),o()(),p(33,ve,2,0,"p",10),o(),r(34,"div",6)(35,"div",7),u(36,"input",17),r(37,"label",18),l(38,"Provincia"),o()(),p(39,be,2,0,"p",10),o(),r(40,"div",6)(41,"div",7),u(42,"input",19),r(43,"label",20),l(44,"Localidad"),o()(),p(45,Ee,2,0,"p",10),o(),r(46,"div",6)(47,"div",7),u(48,"input",21),r(49,"label",22),l(50,"Barrio"),o()(),p(51,Pe,2,0,"p",10),o(),r(52,"div",6)(53,"div",7),u(54,"input",23),r(55,"label",24),l(56,"Direcci\xF3n"),o()(),p(57,Se,2,0,"p",10),o(),p(58,Oe,5,4,"div",6)(59,ye,6,5,"div",6),o(),r(60,"h2")(61,"span"),l(62,"Ordenes"),o(),p(63,Te,2,0,"span"),o(),r(64,"div",25),V(65,Me,1,1,"orden-item",null,F),o()(),r(67,"article",26),p(68,Ve,1,0,"app-loader")(69,Ue,6,0),o()(),r(70,"article",27)(71,"div",28),V(72,ke,2,0,null,null,F),p(74,Ne,2,0,"button",29)(75,Re,1,0,"app-loader"),r(76,"button",30),_("click",function(){return e.openProductsModal=!1}),l(77,"LISTO"),o()()()()),i&2&&(a(5),w("Actualizar Pedido ",e.elemento==null?null:e.elemento.id,""),a(4),P("formGroup",e.form),a(),h("error",e.hasOneError("nombre"))("withValue",e.hasValue("nombre")),a(5),s(15,e.hasError("nombre","required")?15:-1),a(),h("error",e.hasOneError("apellido"))("withValue",e.hasValue("apellido")),a(5),s(21,e.hasError("apellido","required")?21:-1),a(),h("error",e.hasOneError("correo"))("withValue",e.hasValue("correo")),a(5),s(27,e.hasError("correo","required")?27:-1),a(),h("error",e.hasOneError("pais"))("withValue",e.hasValue("pais")),a(5),s(33,e.hasError("pais","required")?33:-1),a(),h("error",e.hasOneError("provincia"))("withValue",e.hasValue("provincia")),a(5),s(39,e.hasError("provincia","required")?39:-1),a(),h("error",e.hasOneError("localidad"))("withValue",e.hasValue("localidad")),a(5),s(45,e.hasError("localidad","required")?45:-1),a(),h("error",e.hasOneError("barrio"))("withValue",e.hasValue("barrio")),a(5),s(51,e.hasError("barrio","required")?51:-1),a(),h("error",e.hasOneError("direccion"))("withValue",e.hasValue("direccion")),a(5),s(57,e.hasError("direccion","required")?57:-1),a(),s(58,e.isAdmin()?-1:58),a(),s(59,e.isAdmin()?59:-1),a(),h("error",e.cantidadTotal===0),a(3),s(63,e.cantidadTotal===0?63:-1),a(2),U(e.elemento==null?null:e.elemento.ordenes),a(3),s(68,e.loadingResponse&&!e.openProductsModal?68:69),a(2),h("open",e.openProductsModal),a(2),U(e.productos),a(2),s(74,e.totalPage!==e.currentPage+1&&!e.loadingResponse?74:-1),a(),s(75,e.loadingResponse?75:-1))},dependencies:[H,oe,ee,W,X,Y,te,ie,ce,I,k,ae],styles:[".update[_ngcontent-%COMP%]{height:calc(100vh - var(--headerHeight) - 2rem);overflow:auto;display:grid;gap:1rem;margin:1rem auto 0;padding:1rem;width:100%;max-width:600px;border-radius:var(--borderrHigh);background-color:var(--bgCardColor)}.update-header[_ngcontent-%COMP%]{text-align:center}.update-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.update-body[_ngcontent-%COMP%]{display:grid;gap:1rem}.update-body[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center;font-size:1.1rem;color:var(--textColor);transition:var(--transitionMid)}.update-body[_ngcontent-%COMP%]   h2.error[_ngcontent-%COMP%]{color:var(--errorColor)}.update-body[_ngcontent-%COMP%]   h2.error[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-size:.8rem;font-weight:400}.pedido-ordenes[_ngcontent-%COMP%]{display:grid;gap:.5rem}.update-footer[_ngcontent-%COMP%]{display:grid;align-items:center}.products-container[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:1050;display:grid;place-items:center;background-color:var(--greyAlphaColor);opacity:0;pointer-events:none;transition:var(--transitionFast)}.products-container.open[_ngcontent-%COMP%]{opacity:1;pointer-events:all}.products-content[_ngcontent-%COMP%]{display:grid;padding:1rem;width:calc(100% - 2rem);max-width:600px;max-height:500px;border-radius:var(--borderrHigh);background-color:var(--bgCardColor);transform:scale(0);transition:var(--transitionUltraFast)}.products-container.open[_ngcontent-%COMP%]   .products-content[_ngcontent-%COMP%]{transform:scale(1)}.producto[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}@media screen and (min-width: 550px){.update-footer[_ngcontent-%COMP%]{grid-template-columns:1fr max-content max-content}.update-footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{justify-self:start}}"]});let n=d;return n})();export{rt as UpdatePageComponent};
